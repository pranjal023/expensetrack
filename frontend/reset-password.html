<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Password | Expense Tracker</title>
  <link rel="stylesheet" href="css/auth.css">
</head>
<body>
  <div class="auth-container">
    <h1>Reset Password</h1>
    <form id="resetForm">
      <input type="password" id="pwd1" placeholder="New password" required minlength="6">
      <input type="password" id="pwd2" placeholder="Confirm password" required minlength="6">
      <button type="submit">Reset Password</button>
    </form>
    <div id="msg" class="message"></div>
  </div>

  <script>
    const BACKEND = 'http://localhost:3000';
    const token = new URLSearchParams(window.location.search).get('token');

    document.getElementById('resetForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const p1 = document.getElementById('pwd1').value;
      const p2 = document.getElementById('pwd2').value;
      const msg= document.getElementById('msg');
      msg.textContent='';

      if(p1 !== p2){
        msg.style.color='red';
        msg.textContent="Passwords don't match.";
        return;
      }
      try{
        const res = await fetch(`${BACKEND}/api/auth/reset-password`,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({token, newPassword:p1})
        });
        const data = await res.json();
        if(data.success){
          msg.style.color='green';
          msg.textContent='Password reset! Redirecting...';
          setTimeout(()=>window.location.href='login.html',3000);
        }else{
          msg.style.color='red';
          msg.textContent=data.message;
        }
      }catch{
        msg.style.color='red';
        msg.textContent='Server error.';
      }
    });
  </script>
</body>
</html>
